{% extends 'userlayout.html' %}
{% load static %}

{% block content %}
    <div class="container">
        <h3>è¯·å‡ / åŠ ç­ç”³è¯·</h3>

        {% if form.errors %}
            <div class="alert alert-danger">
                <strong>è¡¨å•æ ¡éªŒå¤±è´¥ï¼š</strong>
                {{ form.errors }}
            </div>
        {% endif %}

        <form method="post" action="{% url 'leave_overtime' %}" class="form-horizontal">

            {% csrf_token %}

            <div class="form-group">
                <label class="col-sm-2 control-label">ç”³è¯·ç±»å‹</label>
                <div class="col-sm-6">
                    {{ form.type_choice }}
                </div>
            </div>

            <div class="form-group">
                <label class="col-sm-2 control-label">å¼€å§‹æ—¶é—´</label>
                <div class="col-sm-6">
                    {{ form.start_time }}
                </div>
            </div>

            <div class="form-group">
                <label class="col-sm-2 control-label">ç»“æŸæ—¶é—´</label>
                <div class="col-sm-6">
                    {{ form.end_time }}
                </div>
            </div>

            <div class="form-group">
                <label class="col-sm-2 control-label">äº‹ç”±</label>
                <div class="col-sm-6">
                    {{ form.reason }}
                </div>
            </div>

            <div class="form-group">
                <div class="col-sm-offset-2 col-sm-6">
                    <button type="submit" class="btn btn-success">æäº¤ç”³è¯·</button>
                </div>
            </div>
        </form>

        <hr>
        <h4>ğŸ“‹ æˆ‘çš„ç”³è¯·è®°å½•</h4>

        <!-- âœ… è¯·å‡è®°å½• -->
        {% if leave_records %}
            <h5>ğŸŸ© è¯·å‡è®°å½•</h5>
            <table class="table table-bordered table-striped">
                <thead>
                <tr>
                    <th>å¼€å§‹æ—¶é—´</th>
                    <th>ç»“æŸæ—¶é—´</th>
                    <th>åŸå› </th>
                    <th>çŠ¶æ€</th>
                </tr>
                </thead>
                <tbody>
                {% for item in leave_records %}
                    <tr>
                        <td>{{ item.start_time }}</td>
                        <td>{{ item.end_time }}</td>
                        <td>{{ item.reason }}</td>
                        <td>
                            {% if item.status == "pending" %}
                                <span style="color: orange;">å¾…å®¡æ‰¹</span>
                            {% elif item.status == "approved" %}
                                <span style="color: green;">å·²é€šè¿‡</span>
                            {% else %}
                                <span style="color: red;">å·²æ‹’ç»</span>
                            {% endif %}
                        </td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        {% endif %}

        <!-- âœ… åŠ ç­è®°å½• -->
        {% if overtime_records %}
            <h5>ğŸŸ¦ åŠ ç­è®°å½•</h5>
            <table class="table table-bordered table-striped">
                <thead>
                <tr>
                    <th>å¼€å§‹æ—¶é—´</th>
                    <th>ç»“æŸæ—¶é—´</th>
                    <th>åŸå› </th>
                    <th>çŠ¶æ€</th>
                </tr>
                </thead>
                <tbody>
                {% for item in overtime_records %}
                    <tr>
                        <td>{{ item.start_time }}</td>
                        <td>{{ item.end_time }}</td>
                        <td>{{ item.reason }}</td>
                        <td>
                            {% if item.status == "pending" %}
                                <span style="color: orange;">å¾…å®¡æ‰¹</span>
                            {% elif item.status == "approved" %}
                                <span style="color: green;">å·²é€šè¿‡</span>
                            {% else %}
                                <span style="color: red;">å·²æ‹’ç»</span>
                            {% endif %}
                        </td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        {% endif %}

    </div>

    <!-- âœ… æäº¤æˆåŠŸå¼¹çª— -->
    <div class="modal fade" id="successModal" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
            <div class="modal-content" style="border-left: 5px solid green;">
                <div class="modal-header">
                    <h4 class="modal-title">ğŸ‰ æäº¤æˆåŠŸ</h4>
                </div>
                <div class="modal-body">
                    æ‚¨çš„ç”³è¯·å·²æˆåŠŸæäº¤ï¼Œç®¡ç†å‘˜æ­£åœ¨å®¡æ ¸ä¸­ ğŸµ
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-dismiss="modal">æˆ‘çŸ¥é“å•¦</button>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block js %}
    <script src="{% static 'js/jquery-3.7.0.min.js' %}"></script>
    <script src="{% static 'plugins/bootstrap-3.4.1-dist/bootstrap-3.4.1-dist/js/bootstrap.min.js' %}"></script>

    {% if success %}
        <script>
            $(function () {
                $('#successModal').modal('show');
            });
        </script>
    {% endif %}
{% endblock %}
